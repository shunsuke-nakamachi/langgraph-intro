# langgraph入門
langchainとlanggraphがどういうもので何ができるのかを知ってもらうためのロードマップです。
まずtrainingフォルダ内の各セクションのコードを理解して次にpracticeフォルダ何の課題に取り組んでみましょう。

0. イントロダクション
Qiitaの記事です。LangGraphの基本的な考え方を理解するのに役立ちます。
https://qiita.com/sakuraia/items/27db3f118e0ee41c54c1

1. Persistence（永続化・メモリ管理）
Web アプリは基本的に「ステートレス（状態を持たない）」です。ユーザーがブラウザでリロードしたり、別の人がアクセスしてきたりしても、それぞれの会話の状態（State）を正しく維持する必要があります。

学ぶべきこと: Checkpointer (MemorySaver, AsyncSqliteSaver, PostgresSaver など)
なぜ必要か: 今のコードだとプログラムが終了すると会話履歴が消えます。Web アプリでは、データベースに State を保存し、thread_id を使って「Aさんの会話の続き」を復元する仕組みが必須です。

2. Human-in-the-loop（人間による承認・介入）
ファクトチェッカーのように「誤情報の発信が許されない」システムでは、AI が勝手に回答する前に人間が内容を確認し、承認または修正するステップが必要です。

学ぶべきこと: interrupt_before, interrupt_after
なぜ必要か: 「調査完了」→「（ここで一時停止）人間が確認」→「公開」というフローを作るためです。LangGraph はこの「一時停止と再開」を非常に得意としています。

3. Streaming（ストリーミング）
Web アプリで AI の回答を待つ間、画面が数秒間フリーズするのは UX（ユーザー体験）として最悪です。ChatGPT のように、文字が生成されるそばから画面に表示する必要があります。

学ぶべきこと: astream_events, astream_log
なぜ必要か: サーバー側で生成されたトークンをリアルタイムでフロントエンドに送る実装が必要になります。

4. Subgraphs（サブグラフ）
機能が増えると、1つのグラフに全てのノード（調査、執筆、翻訳、校正...）を詰め込むとスパゲッティ化して管理不能になります。

学ぶべきこと: グラフの中にグラフを入れる階層構造
なぜ必要か: 「ファクトチェック」という大きなグラフの中に、「Web検索グラフ」や「文章校正グラフ」といった独立した小さなグラフを部品として組み込むことで、開発とテストが楽になります。

5. Reflection（自己省察・自己修正）
高品質なファクトチェックを行うには、一度生成した回答を AI 自身に「これ本当に正しい？ソースはある？」と批判させ、修正させるループが有効です。

学ぶべきこと: 循環ループの設計と脱出条件
なぜ必要か: 「検索」→「回答生成」→「自己批判（間違い発見）」→「再検索」→「修正回答」というサイクルを作ることで、精度を劇的に向上させることができます。

## 使用しているライブラリ

それぞれのライブラリ（モジュール）の役割について解説します。これらは LangGraph でアプリを作る際の「標準セット」のようなものです。

### 1. 環境設定・型定義

```python
from dotenv import load_dotenv
```

*   **役割**: `.env` ファイルに書かれた内容（APIキーなど）を読み込んで、プログラム内で使えるようにします。
*   **なぜ必要か**: OpenAI の API キーなどをコードに直書きするのは危険なので、隠しファイル（.env）から読み込むのが定石だからです。

```python
from typing import TypedDict, Annotated
```

*   **役割**: Python の標準機能で、「型（データの形）」を定義するためのものです。
*   **なぜ必要か**: LangGraph では `State`（会話の状態）がどのような形をしているかを厳密に定義する必要があるため、これらを使って「辞書型だけど、中身はこうなってますよ」と宣言します。

### 2. AI モデル

```python
from langchain_openai import ChatOpenAI
```

*   **役割**: OpenAI の GPT モデル（gpt-4o など）を Python から簡単に使えるようにした「ラッパー（包み紙）」です。
*   **なぜ必要か**: 生の API を叩くよりも、LangChain/LangGraph のシステムに組み込みやすい形で提供されているためです。

### 3. グラフ構築（LangGraph の核）

```python
from langgraph.graph import StateGraph, START, END
```

*   **役割**:
    *   `StateGraph`: グラフそのものを作る「設計図」の土台です。
    *   `START`: グラフの「入口」を表す特別な定数です。
    *   `END`: グラフの「出口（終了）」を表す特別な定数です。
*   **なぜ必要か**: 「ここから始まって（START）、この処理をして、ここで終わる（END）」という流れを作るために必須です。

```python
from langgraph.graph.message import add_messages
```

*   **役割**: 「新しいメッセージが来たら、古いリストの後ろに追加（append）する」という動きをする**特別な関数**です。
*   **なぜ必要か**: これを使わないと、新しいメッセージが来るたびに古い履歴が上書きされて消えてしまいます。「履歴を積み上げていく」動作のために `Annotated[list, add_messages]` という形で使います。

### 4. 永続化

```python
from langgraph.checkpoint.memory import MemorySaver
```

*   **役割**: 会話の状態（State）をコンピュータのメモリ（一時記憶）に保存するための機能です。
*   **なぜ必要か**: これをグラフにセット（`checkpointer=memory`）することで、`thread_id` を指定して「さっきの続きから」会話を再開できるようになります。
    *   ※ 本番環境では、ここを `PostgresSaver`（データベース）などに変えるだけで、本格的な永続化に切り替えられます。

---

## Training で使用しているライブラリ一覧

以下は `training/requirements.txt` に記載されているライブラリの詳細説明です。

### LangChain / LangGraph コアライブラリ（重要）

#### `langgraph` (1.0.4)

```python
from langgraph.graph import StateGraph, START, END
```

*   **役割**: LangGraph の本体。`StateGraph` を使ってエージェントのワークフロー（処理の流れ）を構築します。
*   **なぜ必要か**: 
    *   `StateGraph` はグラフそのものを作る「設計図」の土台です。
    *   `START` はグラフの「入口」、`END` は「出口（終了）」を表す特別な定数です。
    *   「ここから始まって（START）、この処理をして、ここで終わる（END）」という流れを作るために必須です。

#### `langgraph-checkpoint` (3.0.1)

```python
from langgraph.checkpoint.memory import MemorySaver
```

*   **役割**: 永続化（Checkpointer）の機能を提供。会話の状態（State）をメモリやデータベースに保存します。
*   **なぜ必要か**: 
    *   これをグラフにセット（`checkpointer=memory`）することで、`thread_id` を指定して「さっきの続きから」会話を再開できるようになります。
    *   `MemorySaver`（メモリ保存）、`PostgresSaver`（データベース保存）などが含まれます。
    *   本番環境では `PostgresSaver` に変えるだけで、本格的な永続化に切り替えられます。

#### `langgraph-prebuilt` (1.0.5)

*   **役割**: よく使われるノードやツールの事前構築済みコンポーネント。
*   **なぜ必要か**: 一般的なパターン（例：ツール呼び出しノード、条件分岐ノード）を自分で実装せずに使えるため、開発が速くなります。

#### `langgraph-sdk` (0.2.10)

*   **役割**: LangGraph のクライアント SDK。リモートグラフ（別のサーバーで動いているグラフ）の呼び出しなどに使用。
*   **なぜ必要か**: マイクロサービス構成で、グラフを API として公開する場合に必要になります。

#### `langchain` (1.1.0)

*   **役割**: LangChain の本体。LLM との統合、プロンプト管理、チェーン構築などの基盤ライブラリ。
*   **なぜ必要か**: LangGraph は LangChain の上に構築されているため、基盤として必要です。プロンプトテンプレートやドキュメントローダーなどの便利機能も提供します。

#### `langchain-core` (1.1.0)

```python
from langchain_core.messages import HumanMessage, AIMessage
```

*   **役割**: LangChain のコア機能（メッセージ、ランナブル、ツールなど）を提供。
*   **なぜ必要か**: 
    *   `HumanMessage`（ユーザーからのメッセージ）、`AIMessage`（AI の返答）などのメッセージ型を定義します。
    *   LangGraph の State で使う `messages` リストは、これらのメッセージオブジェクトで構成されます。

#### `langchain-openai` (1.1.0)

```python
from langchain_openai import ChatOpenAI
```

*   **役割**: OpenAI の API（ChatGPT など）を LangChain から簡単に使うためのラッパー（包み紙）。
*   **なぜ必要か**: 
    *   OpenAI の GPT モデル（gpt-4o など）を Python から簡単に使えるようにします。
    *   生の API を叩くよりも、LangChain/LangGraph のシステムに組み込みやすい形で提供されています。

#### `langsmith` (0.4.48)

*   **役割**: LangChain/LangGraph のトレーシング・デバッグツール。実行ログを可視化できます。
*   **なぜ必要か**: 
    *   グラフの実行過程（どのノードがいつ実行されたか、LLM に何を送ったか、何が返ってきたか）を記録・可視化できます。
    *   デバッグや性能分析に非常に便利です（オプション機能）。

### その他の重要なライブラリ

#### `python-dotenv` (1.2.1)

```python
from dotenv import load_dotenv
```

*   **役割**: `.env` ファイルに書かれた内容（API キーなど）を読み込んで、プログラム内で使えるようにします。
*   **なぜ必要か**: OpenAI の API キーなどをコードに直書きするのは危険なので、隠しファイル（.env）から読み込むのが定石だからです。

#### `pydantic` (2.12.5)

```python
from typing import TypedDict, Annotated
```

*   **役割**: データバリデーションと設定管理。State の型定義などに使用されます。
*   **なぜ必要か**: LangGraph では `State`（会話の状態）がどのような形をしているかを厳密に定義する必要があるため、これらを使って「辞書型だけど、中身はこうなってますよ」と宣言します。

### その他のサポートライブラリ

### AI・LLM 関連

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `openai` | 2.8.1 | OpenAI の公式 Python クライアント。GPT-4 などの API を直接呼び出せます。 |
| `tiktoken` | 0.12.0 | OpenAI のトークナイザー。テキストをトークンに分割してトークン数をカウントします。 |

### データ処理・バリデーション

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `pydantic` | 2.12.5 | データバリデーションと設定管理。State の型定義などに使用されます。 |
| `pydantic_core` | 2.41.5 | Pydantic のコア機能（Rust で高速化されています）。 |
| `typing_extensions` | 4.15.0 | Python の型ヒント機能を拡張。Annotated などの新しい型機能を提供。 |
| `typing-inspection` | 0.4.2 | 型情報のランタイム検査をサポート。 |

### HTTP・ネットワーク

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `httpx` | 0.28.1 | 非同期 HTTP クライアント。外部 API 呼び出しに使用（requests の非同期版）。 |
| `httpcore` | 1.0.9 | httpx の低レベル HTTP コア機能。 |
| `requests` | 2.32.5 | 同期 HTTP クライアント。シンプルな API 呼び出しに使用。 |
| `requests-toolbelt` | 1.0.0 | requests の拡張ツール（マルチパート、ストリーミングなど）。 |
| `urllib3` | 2.5.0 | HTTP クライアントの基盤ライブラリ。 |
| `certifi` | 2025.11.12 | SSL 証明書の検証に使用される信頼できる CA バンドル。 |

### JSON・データシリアライゼーション

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `orjson` | 3.11.4 | 高速な JSON シリアライザー（Rust 実装）。 |
| `ormsgpack` | 1.12.0 | MessagePack のシリアライザー。バイナリ形式でデータを効率的に保存。 |
| `jsonpatch` | 1.33 | JSON Patch（RFC 6902）の実装。差分更新に使用。 |
| `jsonpointer` | 3.0.0 | JSON Pointer（RFC 6901）の実装。JSON 内の特定の値を参照。 |
| `jiter` | 0.12.0 | 高速な JSON イテレーター。 |

### ユーティリティ

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `python-dotenv` | 1.2.1 | `.env` ファイルから環境変数を読み込む。API キーの管理に必須。 |
| `dotenv` | 0.9.9 | 古いバージョンの dotenv（python-dotenv を使うことを推奨）。 |
| `PyYAML` | 6.0.3 | YAML ファイルの読み書き。設定ファイルの管理に使用。 |
| `packaging` | 25.0 | パッケージバージョンの解析・比較。 |
| `tenacity` | 9.1.2 | リトライロジックの実装。API 呼び出しの失敗時に自動再試行。 |
| `tqdm` | 4.67.1 | プログレスバーの表示。長時間処理の進捗を可視化。 |

### グラフ・可視化

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `grandalf` | 0.8 | グラフレイアウトアルゴリズム。LangGraph の可視化に使用。 |

### その他

| ライブラリ | バージョン | 役割 |
|-----------|-----------|------|
| `anyio` | 4.11.0 | 非同期 I/O の抽象化レイヤー。asyncio と trio の両方をサポート。 |
| `sniffio` | 1.3.1 | 実行中の非同期ライブラリを検出（asyncio か trio か）。 |
| `h11` | 0.16.0 | HTTP/1.1 プロトコルの低レベル実装。 |
| `idna` | 3.11 | 国際化ドメイン名（IDN）のエンコード・デコード。 |
| `charset-normalizer` | 3.4.4 | 文字エンコーディングの自動検出。 |
| `distro` | 1.9.0 | Linux ディストリビューション情報の取得。 |
| `regex` | 2025.11.3 | 高度な正規表現機能（標準 re モジュールの拡張）。 |
| `pyparsing` | 3.2.5 | テキストパーサーの構築ライブラリ。 |
| `xxhash` | 3.6.0 | 高速ハッシュアルゴリズム。 |
| `zstandard` | 0.25.0 | Zstandard 圧縮アルゴリズムの Python バインディング。 |
| `annotated-types` | 0.7.0 | Pydantic で使用される型アノテーション。 |


これらのライブラリは LangGraph アプリケーション開発の標準的なスタックです。必要に応じて追加のライブラリ（例：データベース接続用の `psycopg2`、Web フレームワーク用の `fastapi` など）をインストールしてください。# langgraph-intro
# langgraph-intro
